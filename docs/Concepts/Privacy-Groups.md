---
description: Tessera privacy groups
---

# Privacy groups

Tessera supports operations related to privacy groups such as managing privacy group data and handling transactions that
are intended for a privacy group.
However, there might be different in behaviors depending on which `mode` Tessera is running on.
See [client mode](../HowTo/Configure/Tessera.md#orion-mode).

There are three types of privacy group:

- Legacy
- Pantheon
- Resident

A unique `privacyGroupId` is used to identify individual privacy groups.

For private transactions sent to a privacy group, the corresponding `privacyGroupId` is stored alongside the transaction.

!!! note

    Once created, you can't change the members of a privacy group.
    To add or remove members, you must create a new privacy group.

Privacy groups are currently supported by [Hyperledger Besu](https://besu.hyperledger.org/en/stable/),
which maintains a [private state per privacy group](https://besu.hyperledger.org/en/stable/Concepts/Privacy/Privacy-Groups/).

An example of a privacy group and its related data:

```json
{
    "privacyGroupId": "jufzisK63xbXDciV0FW1uAi3vXFDNNJpf/M3lUhMiU0=",
    "name": "groupA",
    "description": "A description of this group",
    "type": "PANTHEON",
    "members": [
      "98FhPni7u6YspDGcOLl/LgQQwwGPGY4ddm3hmogsqF8=",
      "dzkrEhkHZ/IjHEaQ6teVTU/kMjiwXTI6Ooljcb56w1M="
    ]
}
```

## Legacy privacy group

Tessera automatically creates a legacy privacy group when a private transaction is sent to a list of recipient public
keys using `privateFor`.

When returning private transaction data to a Besu client (as part of a `/receive` response), the legacy `privacyGroupId`
is also returned.

The legacy `privacyGroupId` is generated by hashing the list of recipient keys.
For a given set of recipients, there can be only one legacy privacy group.

!!! note

    Besu and Tessera generate the same legacy `privacyGroupId` from the same list of recipients.

## Pantheon privacy group

Tessera supports API methods that enable the creation of pantheon privacy groups from a compatible blockchain client
(for example, Besu).

Upon creation, the privacy group is distributed to all members ahead of transaction processing.

When a private transaction contains a `privacyGroupId`, the transaction payload is distributed to all the members of the
privacy group.

The pantheon `privacyGroupId` is generated by hashing the list of recipient keys *plus a random seed*.
This means that for a given set of recipients, there can be many pantheon privacy groups.

## Resident privacy group

The concept of resident privacy group was introduced to accommodate GoQuorum multiple private states feature.
A resident group contains a list of member keys that are locally managed, and those members share the same private state.

Key differences between a resident group and other types of privacy group include:

* A resident group can only contain local keys, not remote keys.
* The name of the resident group is the group identifier.
* Resident groups can be configured via the Tessera configuration file.
  However, the `multiplePrivacyStates` feature must be enabled. See the configuration section for more details.

A number of validations are performed against the resident group configuration during Tessera startup (when
`multiplePrivacyStates` is enabled):

* All members of resident groups must be locally managed by the node.
* A member can't be configured to belong to more than one resident group at any time (all history considered).
* All keys configured must belong to a resident group and no key can be left out.

## Database storage

A new table called `PRIVACY_GROUP` is added to Tessera's database to store privacy group data.

DDLs are provided along with release notes to create new privacy group tables.

!!! example

    ```sql
    CREATE TABLE PRIVACY_GROUP(ID LONGVARBINARY NOT NULL, LOOKUP_ID LONGVARBINARY NOT NULL, DATA LONGVARBINARY NOT NULL, TIMESTAMP BIGINT, PRIMARY KEY (ID));
    ```

Before being persisted into the database, privacy group data is encoded using `BinaryEncoder` (the same mechanism
Tessera uses to encode its `EncodedPayload` data).

## API versioning

A node running a version of Tessera that doesn't support privacy groups can't understand requests containing `privacyGroupId`.
This can cause inconsistency of data being persisted on different nodes.

Hence, API version 3.0 has been introduced.
Tessera includes the privacy group in the encoded payload in `/push` to only those recipients supporting correct version,
otherwise the transaction fails with `PrivacyGroupNotSupportedException`.

## Privacy group APIs

Privacy group compatible blockchain clients (for example, Besu) can be used to create, delete, find, and retrieve
privacy groups.
Tessera's `Q2T` API adds support for these operations.
Please refer to [API reference](https://consensys.github.io/doc.tessera/) for more details.
